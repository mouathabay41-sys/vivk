<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ¤– Vivk AI</title>
  <style>
    :root{
      --bg:#0b0b0b; --card:#121212; --accent:#00ff7f; --muted:#bdbdbd;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--muted);font-family:Tahoma,Arial,sans-serif;display:flex;flex-direction:column;min-height:100vh;align-items:center;padding:18px}
    header{color:var(--accent);font-size:22px;font-weight:700;margin-bottom:12px;display:flex;gap:10px;align-items:center}
    #app{width:100%;max-width:800px;display:flex;flex-direction:column;align-items:stretch}
    #chat{background:var(--card);border-radius:12px;padding:14px;height:60vh;overflow:auto;border:1px solid rgba(0,255,127,0.08)}
    .bubble{margin:8px 0;padding:12px;border-radius:10px;max-width:86%}
    .user{background:var(--accent);color:#000;margin-left:auto;text-align:right}
    .bot{background:#171717;color:#e8ffe9;border:1px solid rgba(0,255,127,0.12)}
    .bot strong{color:var(--accent)}
    .img-resp{max-width:100%;border-radius:8px;display:block;margin-top:8px}
    #controls{display:flex;gap:8px;margin-top:12px}
    #text{flex:1;padding:12px;border-radius:10px;border:1px solid #222;background:#0b0b0b;color:var(--muted);outline:none}
    button{padding:0 16px;border-radius:10px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
    .muted-btn{background:#222;color:var(--muted)}
    .small{padding:8px 12px}
    footer{font-size:13px;color:#777;margin-top:14px}
    @media (max-width:480px){#chat{height:56vh}}
  </style>
</head>
<body>
  <header>ğŸ¤– ÙÙŠÙŠÙƒ - Vivk AI</header>
  <div id="app">
    <div id="chat" aria-live="polite"></div>

    <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
      <button id="modeBtn" class="muted-btn small">ğŸ” ÙˆØ¶Ø¹: Ù†Øµ</button>
      <div style="flex:1;display:flex;gap:8px" id="controls">
        <input id="text" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ (Ø£Ùˆ Ø§ÙƒØªØ¨: !image ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©)" />
        <button id="send">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
    </div>

    <footer>Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„ØµÙˆØ± ØªÙˆÙ„Ø¯ Ø¹Ø¨Ø± OpenAI ÙˆØ³ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙÙ‚Ø· Ù…Ø¤Ù‚ØªØ§Ù‹. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¢Ù…Ù†.</footer>
  </div>

  <script>
    const chatEl = document.getElementById("chat");
    const input = document.getElementById("text");
    const sendBtn = document.getElementById("send");
    const modeBtn = document.getElementById("modeBtn");
    let mode = "chat"; // "chat" Ø£Ùˆ "image"

    function addBubble(text, who="bot", isHTML=false) {
      const div = document.createElement("div");
      div.className = "bubble " + (who==="user" ? "user" : "bot");
      if(isHTML) div.innerHTML = text; else div.textContent = text;
      chatEl.appendChild(div);
      chatEl.scrollTop = chatEl.scrollHeight;
      return div;
    }

    modeBtn.addEventListener("click", () => {
      mode = (mode === "chat") ? "image" : "chat";
      modeBtn.textContent = mode === "chat" ? "ğŸ” ÙˆØ¶Ø¹: Ù†Øµ" : "ğŸ–¼ï¸ ÙˆØ¶Ø¹: ØµÙˆØ±Ø©";
      input.placeholder = mode === "chat" ? "Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ (Ø£Ùˆ Ø§ÙƒØªØ¨: !image ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©)" : "Ø§ÙƒÙ„ÙÙ… Ø§Ù„Ù…ÙˆÙ„Ø¯: ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯Ù‡Ø§...";
    });

    async function send() {
      const text = input.value.trim();
      if (!text) return;

      // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£Ù…Ø± Ù…Ø¨Ø§Ø´Ø± Ù„Ø¹Ù…Ù„ ØµÙˆØ±Ø©: !image ÙˆØµÙ...
      if (text.startsWith("!image ") || mode === "image") {
        const prompt = text.startsWith("!image ") ? text.slice(7).trim() : text;
        addBubble("ğŸ‘¤ " + (prompt || text), "user");
        input.value = "";
        const loading = addBubble("â³ ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø©... Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±", "bot");
        try {
          const res = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ type: "image", prompt, size: "1024x1024" })
          });
          const data = await res.json();
          loading.remove();
          if (data.error) {
            addBubble("âš ï¸ Ø®Ø·Ø£: " + (data.error.message || data.error), "bot");
            return;
          }
          if (data.image) {
            const html = `<strong>ÙÙŠÙŠÙƒ - Vivk AI:</strong><br><img src="${data.image}" class="img-resp" alt="generated image" />`;
            addBubble(html, "bot", true);
          } else {
            addBubble("Ù„Ù… ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±Ø©.", "bot");
          }
        } catch (err) {
          loading.remove();
          addBubble("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + err.message, "bot");
        }
        return;
      }

      // normal chat
      addBubble("ğŸ‘¤ " + text, "user");
      input.value = "";
      const loading = addBubble("â³ ÙÙŠÙŠÙƒ ÙŠÙÙƒØ±...", "bot");
      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ type: "chat", message: text })
        });
        const data = await res.json();
        loading.remove();
        if (data.error) {
          addBubble("âš ï¸ Ø®Ø·Ø£: " + (data.error || "Ù„Ù… Ù†ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø±Ø¯"), "bot");
        } else {
          addBubble(`<strong>ÙÙŠÙŠÙƒ - Vivk AI:</strong>\n${data.reply}`, "bot", true);
        }
      } catch (err) {
        loading.remove();
        addBubble("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + err.message, "bot");
      }
    }

    sendBtn.addEventListener("click", send);
    input.addEventListener("keydown", (e) => { if (e.key === "Enter") send(); });

    // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    addBubble("Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ ÙÙŠÙŠÙƒ â€” Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ. Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ Ù„Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø©.", "bot");
  </script>
</body>
</html>